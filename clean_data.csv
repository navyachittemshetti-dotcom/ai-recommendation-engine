# -*- coding: utf-8 -*-
"""Data cleaning for recommendation system

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1IE5PFeDiTxVg9KR0v4DH-2BgU1-vtOoW
"""

import pandas as pd
import numpy as np

from google.colab import files
uploaded = files.upload()

data = pd.read_csv("clean_data.csv")

data.head(2)

data.tail(2)

data.info()

data[data["User's ID"] == '-2147483648']

# We check that how many values in our ProdID column which starts from hyphen as the above row we found from sample command
# Also as the startswith function is a function of str datatype, so we have to convert our col into str with astype function
data[data['ProdID'].astype(str).str.startswith('-')]

# Now we will remove these rows with the nan or null keyword
data['ProdID'] = data['ProdID'].replace('-2147483648', np.nan)

# Same we will check with the ID col also
data[data["User's ID"].astype(str).str.startswith('-')]

# Now we will remove these ID column rows with the nan or null keyword, i have written this value in the str format bcoz our col is now str
data["User's ID"] = data["User's ID"].replace('-2147483648', np.nan)

# Now when i check it then there is no value with this value in ID column
data[data["User's ID"] == '-2147483648']

# Now when i check it then there is no value with this value in prodID column
data[data['ProdID'] == '-2147483648']

data[data["User's ID"]=='0']

data.info()

data.isnull().sum()

# As i wanted to convert the datatype of id and prod id col from object to int so for that first i have to remove all null values
data = data.dropna(subset=["User's ID"])

data["User's ID"]=='nan'

# Convert all ID values to numeric and force invalid ones to NaN
data["User's ID"] = pd.to_numeric(data["User's ID"], errors='coerce')

# Drop rows where ID is missing after conversion
data = data.dropna(subset=["User's ID"])

# Convert to integer
data["User's ID"] = data["User's ID"].astype('int64')

data.info()

# Drop rows where ID is missing after conversion
data = data.dropna(subset=['ProdID'])

# Convert to integer
data['ProdID'] = data['ProdID'].astype('int64')

data.info()

# Convert to integer
data['Review Count'] = data['Review Count'].astype('int64')

data.info()

data.isnull().sum()

# It fills with an empty string
# It is okay for a recommendation system
# Because for text-based recommendation systems (TF-IDF, embeddings, cosine similarity):

# Empty string simply means “no additional text”
# It does NOT affect similarity scores
# It prevents errors when converting text → vectors
# TF-IDF and embeddings can safely handle empty text

# This is exactly what we do in real machine learning pipelines.

data['Category'] = data['Category'].fillna('')
data['Brand'] = data['Brand'].fillna('')
data['Description'] = data['Description'].fillna('')
data['Tags'] = data['Tags'].fillna('')

data.info()

data.isnull().sum()

# Now we have all values filled without null

# To check that any row is completely repeated
data.duplicated().sum()

data.shape

data.describe()

data.head(20)

num_users = data["User's ID"].nunique()
num_product = data['ProdID'].nunique()
num_ratings = data['Rating'].nunique()

print(f"Number of unique users: {num_users}")
print(f"Number of unique items: {num_product}")
print(f"Number of unique ratings: {num_ratings}")

# Most Popular Items

import matplotlib.pyplot as plt

popular_items = data['ProdID'].value_counts().head(5)
popular_items.plot(kind='bar', color='red')
plt.title("Most Popular items")

data= data[data['ProdID'] != '-2147483648']

# Most Popular Items

import matplotlib.pyplot as plt

popular_items = data['ProdID'].value_counts().head(5)
popular_items.plot(kind='bar', color='red')
plt.title("Most Popular items")

# Most rated counts
data['Rating'].value_counts().plot(kind='bar',color='red')

"""## Rating based Recommendation"""

# Calculate average ratings of each product
average_ratings = data.groupby(['Name', 'Review Count', 'Brand', 'ImageURL'])['Rating'].mean().reset_index()

data.groupby(['Name', 'Review Count', 'Brand', 'ImageURL'])['Rating'].mean().reset_index()

# Sort products by highest rating
average_ratings.sort_values(by='Rating', ascending=False)

# Sort products by highest rating
top_rated_items = average_ratings.sort_values(by='Rating', ascending=False)

#Top 10 items
top_rated_items.head(10)

rating_based_recommendation = top_rated_items.head(10)

best_sellers = data.groupby(
    ['Name', 'Brand', 'ImageURL']
)['Review Count'].max().reset_index()

best_sellers = best_sellers.sort_values(
    by='Review Count',
    ascending=False
)

best_sellers.head(20)

best_sellers.Name.head(5)











